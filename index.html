<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLBB Treasure Hunt</title>
    <style>
        body { font-family: sans-serif; background: #222; color: #fff; text-align: center; margin: 0; padding: 20px; }
        
        /* Containers */
        .container { max-width: 800px; margin: 0 auto; background: #333; padding: 20px; border-radius: 10px; }
        .hidden { display: none; }
        
        /* Inputs */
        input { padding: 10px; width: 70%; margin: 5px; border-radius: 5px; border: none; }
        button { padding: 10px 20px; background: #f39c12; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 10px;}
        button:hover { background: #d35400; }
        button:disabled { background: #555; cursor: not-allowed; }

        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(35px, 1fr)); gap: 4px; margin-top: 20px; }
        .tile { 
            background: #444; 
            height: 35px; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; font-size: 10px; color: #aaa; border-radius: 3px;
        }
        .tile:hover { background: #555; }
        .tile.open { background: #222; color: #444; cursor: default; }
        .tile.win { background: #f1c40f; color: black; font-size: 20px; animation: pop 0.5s; }
        
        @keyframes pop { 0% { transform: scale(0.5); } 100% { transform: scale(1); } }
        
        /* Admin Box */
        .admin-box { border: 1px solid #555; padding: 15px; margin-bottom: 20px; background: #2a2a2a; }
        .link-display { background: #111; color: #0f0; padding: 10px; word-break: break-all; margin-top: 10px; font-family: monospace; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>MLBB Gold Chest Hunt</h1>

    <!-- 1. ADMIN PANEL (Only visible if no game is loaded) -->
    <div id="adminPanel" class="admin-box">
        <h3>ðŸ‘® Admin: Create Game</h3>
        <p>Where do you want to hide the chest? (1-1000)</p>
        <input type="number" id="adminNum" placeholder="e.g. 20" min="1" max="1000">
        <br>
        <button onclick="generateLink()">Generate Play Link</button>
        <div id="linkOutput" class="link-display"></div>
    </div>

    <!-- 2. PLAYER LOGIN -->
    <div id="loginPanel" class="hidden">
        <h3>ðŸ‘¤ Player Login</h3>
        <input type="text" id="mlbbId" placeholder="MLBB ID">
        <input type="text" id="mlbbServer" placeholder="Server ID">
        <br>
        <button onclick="startGame()">Start Game</button>
    </div>

    <!-- 3. GAME GRID -->
    <div id="gamePanel" class="hidden">
        <p>Player: <span id="displayPlayer" style="color:#f39c12"></span> | <span id="status">Ready</span></p>
        <div class="grid" id="grid"></div>
    </div>
</div>

<script>
    const TOTAL_TILES = 1000;
    const COOLDOWN_MS = 100; // 0.5 seconds
    
    let secretTile = 0;
    let canClick = true;

    // --- ON LOAD: Check if this is Admin or Player ---
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const secretCode = urlParams.get('game');

        if (secretCode) {
            // PLAYER MODE: Found a game code in URL
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('loginPanel').classList.remove('hidden');
            try {
                // Decode the number from Base64 so players can't easily read URL
                secretTile = parseInt(atob(secretCode));
            } catch(e) {
                alert("Invalid Game Link");
            }
        } else {
            // ADMIN MODE: No code, let user create one
            document.getElementById('adminPanel').style.display = 'block';
        }
    };

    // --- ADMIN: Generate Link ---
    function generateLink() {
        const num = document.getElementById('adminNum').value;
        if(num < 1 || num > 1000) return alert("Pick 1-1000");

        // Simple encoding to hide the number in the URL
        const code = btoa(num); 
        const link = window.location.href.split('?')[0] + "?game=" + code;

        const out = document.getElementById('linkOutput');
        out.style.display = 'block';
        out.innerHTML = `Send this to player:<br><br><a href="${link}" style="color:#0f0">${link}</a>`;
    }

    // --- PLAYER: Start Game ---
    function startGame() {
        const id = document.getElementById('mlbbId').value;
        const server = document.getElementById('mlbbServer').value;
        if(!id || !server) return alert("Enter Info");

        document.getElementById('displayPlayer').innerText = id + " (" + server + ")";
        document.getElementById('loginPanel').classList.add('hidden');
        document.getElementById('gamePanel').classList.remove('hidden');
        
        renderGrid();
    }

    // --- RENDER GRID ---
    function renderGrid() {
        const grid = document.getElementById('grid');
        let html = "";
        for(let i=1; i<=TOTAL_TILES; i++) {
            html += `<div class="tile" id="t${i}" onclick="clickTile(${i})">${i}</div>`;
        }
        grid.innerHTML = html;
    }

    // --- GAME LOGIC ---
    function clickTile(num) {
        if(!canClick) return;
        const tile = document.getElementById(`t${num}`);
        if(tile.classList.contains('open') || tile.classList.contains('win')) return;

        // Cooldown
        canClick = false;
        document.getElementById('status').innerText = "Cooldown...";
        document.getElementById('status').style.color = "red";
        
        setTimeout(() => {
            canClick = true;
            document.getElementById('status').innerText = "Ready";
            document.getElementById('status').style.color = "#fff";
        }, COOLDOWN_MS);

        // Check Win
        if(num === secretTile) {
            tile.classList.add('win');
            tile.innerHTML = "ðŸ’°"; // Gold Chest
            alert(`ðŸŽ‰ FOUND IT! \nChest was at ${num}\nWinner: ${document.getElementById('mlbbId').value}`);
        } else {
            tile.classList.add('open');
            tile.style.background = "#222"; // Hide logic
        }
    }
</script>

</body>
</html>
